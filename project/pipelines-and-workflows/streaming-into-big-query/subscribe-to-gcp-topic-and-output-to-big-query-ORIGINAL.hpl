<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>subscribe-to-gcp-topic-and-output-to-big-query</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <pipeline_status>0</pipeline_status>
    <parameters>
      <parameter>
        <name>PARAM_BIG_QUERY_DATASET_ID</name>
        <default_value>sensor_data</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_BIG_QUERY_TABLE_ID</name>
        <default_value>simple</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_GCP_PROJECT_ID</name>
        <default_value>kettle-beam-224314</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_GCP_PUB_SUB_SUBSCRIPTION</name>
        <default_value>projects/kettle-beam-224314/subscriptions/testsubscription</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_GCP_PUB_SUB_TOPIC</name>
        <default_value>projects/kettle-beam-224314/topics/test</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_OUTPUT_DIRECTORY</name>
        <default_value>gs://hop-beam-storage/output</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_OUTPUT_FILE_PREFIX</name>
        <default_value>events-aggregated-</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PARAM_OUTPUT_FILE_SUFFIX</name>
        <default_value>.csv</default_value>
        <description/>
      </parameter>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2020/06/02 08:03:09.869</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/06/02 08:03:09.869</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>Important: Beam Job Config has to stage following plugin:
kettle-json-plugin</note>
      <xloc>16</xloc>
      <yloc>32</yloc>
      <width>361</width>
      <heigth>42</heigth>
      <fontname>.AppleSystemUIFont</fontname>
      <fontsize>13</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>14</fontcolorred>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorblue>90</fontcolorblue>
      <backgroundcolorred>201</backgroundcolorred>
      <backgroundcolorgreen>232</backgroundcolorgreen>
      <backgroundcolorblue>251</backgroundcolorblue>
      <bordercolorred>14</bordercolorred>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorblue>90</bordercolorblue>
    </notepad>
    <notepad>
      <note>Weâ€™ve got to use the Beam Timestamp transform first before 
using the the Beam Window transform in order to define which 
Timestamp should be used for the windowing function.</note>
      <xloc>544</xloc>
      <yloc>32</yloc>
      <width>392</width>
      <heigth>58</heigth>
      <fontname>.AppleSystemUIFont</fontname>
      <fontsize>13</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>14</fontcolorred>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorblue>90</fontcolorblue>
      <backgroundcolorred>201</backgroundcolorred>
      <backgroundcolorgreen>232</backgroundcolorgreen>
      <backgroundcolorblue>251</backgroundcolorblue>
      <bordercolorred>14</bordercolorred>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorblue>90</bordercolorblue>
    </notepad>
    <notepad>
      <note>Parameter	Default Value	Description
PARAM_BIG_QUERY_DATASET_ID	sensor_data	
PARAM_BIG_QUERY_TABLE_ID	simple	
PARAM_GCP_PROJECT_ID	kettle-beam-224314	
PARAM_GCP_PUB_SUB_SUBSCRIPTION	projects/kettle-beam-224314/subscriptions/testsubscription	
PARAM_GCP_PUB_SUB_TOPIC	projects/kettle-beam-224314/topics/test	
PARAM_OUTPUT_DIRECTORY	gs://hop-beam-storage/output	
PARAM_OUTPUT_FILE_PREFIX	events-aggregated-	
PARAM_OUTPUT_FILE_SUFFIX	.csv	
</note>
      <xloc>976</xloc>
      <yloc>32</yloc>
      <width>634</width>
      <heigth>218</heigth>
      <fontname>.AppleSystemUIFont</fontname>
      <fontsize>13</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>14</fontcolorred>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorblue>90</fontcolorblue>
      <backgroundcolorred>201</backgroundcolorred>
      <backgroundcolorgreen>232</backgroundcolorgreen>
      <backgroundcolorblue>251</backgroundcolorblue>
      <bordercolorred>14</bordercolorred>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorblue>90</bordercolorblue>
    </notepad>
    <notepad>
      <note>Currently there is a bug running the Memory Group By
transform on Beam.</note>
      <xloc>608</xloc>
      <yloc>325</yloc>
      <width>338</width>
      <heigth>42</heigth>
      <fontname>.AppleSystemUIFont</fontname>
      <fontsize>13</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>14</fontcolorred>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorblue>90</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>38</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>14</bordercolorred>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorblue>90</bordercolorblue>
    </notepad>
  </notepads>
  <order>
    <hop>
      <from>Beam GCP Pub/Sub : Subscribe</from>
      <to>JSON input: Extract fields</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>JSON input: Extract fields</from>
      <to>Select values: Remove message</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values: Remove message</from>
      <to>Beam Timestamp: Get event_time</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Beam Timestamp: Get event_time</from>
      <to>Beam Window</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Beam Window</from>
      <to>Memory group by sensor_id</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Memory group by sensor_id</from>
      <to>Beam BigQuery Output</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Memory group by sensor_id</from>
      <to>Beam Output</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Select values: Remove message</from>
      <to>Beam Output</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Beam BigQuery Output</name>
    <type>BeamBQOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <project_id>${PARAM_GCP_PROJECT_ID}</project_id>
    <dataset_id>${PARAM_BIG_QUERY_DATASET_ID}</dataset_id>
    <table_id>${PARAM_BIG_QUERY_TABLE_ID}</table_id>
    <create_if_needed>Y</create_if_needed>
    <truncate_table>N</truncate_table>
    <fail_if_not_empty>N</fail_if_not_empty>
    <attributes/>
    <GUI>
      <xloc>480</xloc>
      <yloc>432</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Beam GCP Pub/Sub : Subscribe</name>
    <type>BeamSubscribe</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <subscription>${PARAM_GCP_PUB_SUB_SUBSCRIPTION}</subscription>
    <topic>${PARAM_GCP_PUB_SUB_TOPIC}</topic>
    <message_type>String</message_type>
    <message_field>message</message_field>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>96</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Beam Output</name>
    <type>BeamOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <output_location>${PARAM_OUTPUT_DIRECTORY}</output_location>
    <file_description_name/>
    <file_prefix>${PARAM_OUTPUT_FILE_PREFIX}</file_prefix>
    <file_suffix>${PARAM_OUTPUT_FILE_SUFFIX}</file_suffix>
    <windowed>Y</windowed>
    <attributes/>
    <GUI>
      <xloc>672</xloc>
      <yloc>416</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Beam Timestamp: Get event_time</name>
    <type>BeamTimestamp</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <field_name>event_time</field_name>
    <read_timestamp>N</read_timestamp>
    <attributes/>
    <GUI>
      <xloc>480</xloc>
      <yloc>96</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Beam Window</name>
    <type>BeamWindow</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <window_type>Fixed</window_type>
    <duration>60</duration>
    <every/>
    <max_window_field/>
    <start_window_field>window_start_time</start_window_field>
    <end_window_field>window_end_time</end_window_field>
    <attributes/>
    <GUI>
      <xloc>480</xloc>
      <yloc>192</yloc>
    </GUI>
  </transform>
  <transform>
    <name>JSON input: Extract fields</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>event_time</name>
        <path>event_time</path>
        <type>Timestamp</type>
        <format>yyyy-MM-dd HH:mm:ss.SSS</format>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>sensor_id</name>
        <path>sensor_id</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>amount</name>
        <path>amount</path>
        <type>Integer</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>message</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>208</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Memory group by sensor_id</name>
    <type>MemoryGroupBy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <give_back_row>N</give_back_row>
    <group>
      <field>
        <name>window_start_time</name>
      </field>
      <field>
        <name>sensor_id</name>
      </field>
    </group>
    <fields>
      <field>
        <aggregate>amount</aggregate>
        <subject>amount</subject>
        <type>SUM</type>
        <valuefield/>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>480</xloc>
      <yloc>320</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Select values: Remove message</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>message</name>
      </remove>
    </fields>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>320</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
